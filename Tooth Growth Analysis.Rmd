---
title: "Tooth Growth Analysis"
author: "Helen"
date: "24 October 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE, warning = FALSE)
library(ggplot2)
library(grid)
library(gridExtra)
library(tidyr)
library(dplyr)
```

## Overview

This report analyses the ToothGrowth data from the R datasets. The data is explored, summarised and compared. A sample of the dataset is shown below.

```{r data}
head(ToothGrowth)
```

## Exploratory analysis

The data has three variables: "len", "supp" and "dose". The results split by supp and dose are shown in the graph below.

```{r summary all}
g1 <- ggplot(ToothGrowth, aes(x = supp, y = len, fill = supp)) + geom_boxplot() + facet_grid(. ~ dose) + ggtitle("Tooth growth boxplots") + xlab("Dosage size") + ylab("Length") + guides(fill = "none")
g1

```

The graph shows that for both supplements the length tends to increase as dose increases. The OJ supplement appears to result in greater length than VC for doses 0.5 and 1, but the supplements appear to result in similar lengths at doses of 2.

The graph also shows that the resulting lengths were slightly more variable for the OJ supplement at doses 0.5 and 1, though a lot less variable than VC at dose 2.

It remains to be seen whether these differences are significant.

There is some overlap in the lengths resulting from different doses, particularly from the OJ supplement. This can be seen in the graph below.

```{r dotplot}
g3 <- ggplot(ToothGrowth, aes(y = len, x = 1, fill = factor(dose))) + geom_dotplot(binwidth= 1, method = "histodot", binaxis = "y", stackgroups = TRUE, stackdir = "center") + facet_grid(. ~ supp) + ggtitle("Overall observations") + xlab("Supplement") + ylab("Length") + scale_fill_manual(values = c("skyblue", "royalblue", "navy"), name = "Dose") + scale_x_continuous(NULL, breaks = NULL)
g3
```

The graph also shows that a greater range of lengths resulted from the VC supplement. It can be seen that each dose and supplement combination has 10 observations.


## Data summary

The data consists of 60 observations of odontoblast length, subdivided by supplement and dose. The table below summarises the data and its main features.

```{r data summary}
tg <- tbl_df(ToothGrowth)
tg <- group_by(tg, dose, supp)
summarise(tg, n(), min(len), max(len), mean(len), sd(len))
```

## Comparing tooth growth by supp and dose

First, this report considers the two supplements separately, and tests whether the differences in odontoblast length seen due to the different dosage levels of each supplement are significant. For example, is the difference is length resulting from receiving a dosage of 0.5 OJ significantly different to that resulting from a dosage of 1 OJ?

### OJ
#### *Is the additional length seen at dosage 1 significantly higher than at dosage 0.5?*

**Null hypothesis:** The mean of OJ's dosage 1 is the same as the mean of OJ's dosage 0.5.  
**Alternative hypothesis:** The mean of OJ's dosage 1 is greater than the mean of OJ's dosage 0.5.

The data are not paired, so an independent t-test must be used.

```{r OJ 0.5 and 1}
OJ0 <- filter(ToothGrowth, supp == "OJ", dose == 0.5)
OJ1 <- filter(ToothGrowth, supp == "OJ", dose == 1)

t.test(OJ0[, 1], OJ1[, 1], alt = "less", mu = 0, paired = FALSE, var.equal = FALSE)
```

Manual calculation of t statistic:

```{r OJ 0.5 and 1 manual}
var <- ((nrow(OJ0)-1)*var(OJ0[, 1])+(nrow(OJ1)-1)*var(OJ1[, 1]))/(nrow(OJ0)+nrow(OJ1)-2)

t <- (mean(OJ0[, 1]) - mean(OJ1[, 1])) / (sqrt(var) * (1/10 + 1/10)^0.5)
t
```

Manual calculation of confidence interval of t statistic:

```{r OJ 0.5 and 1 manual 2}
ci <- mean(OJ0[, 1]) - mean(OJ1[, 1]) + 1 * qt(0.95, 18) * sqrt(var) * (1/10 + 1/10)^0.5
ci
```

Manual calculation of p value:

```{r OJ 0.5 and 1 manual 3}
pt(t, df = 18)
```

The manual calculations agree with the t.test calculations.

The results show that it is 95% certain that the mean of OJ dose 0.5 minus the mean of OJ dose 1 is -6.21 or less. This does not include zero so the means are statistically significantly different. The p-value for the test is 4.2x10^-5^ which means the result is significant at the 5% level.

#### *Is the additional length seen at dosage 2 significantly higher than at dosage 1?*

**Null hypothesis:** The mean of OJ's dosage 2 is the same as the mean of OJ's dosage 1.  
**Alternative hypothesis:** The mean of OJ's dosage 2 is greater than the mean of OJ's dosage 1.

```{r OJ 1 and 2}
OJ2 <- filter(ToothGrowth, supp == "OJ", dose == 2)
t.test(OJ1[, 1], OJ2[, 1], alt = "less", paired = FALSE, var.equal = FALSE)
```

Manual checks:

```{r OJ 1 and 2 manual}
var <- (((nrow(OJ1)-1)*var(OJ1[, 1]))+(nrow(OJ2)-1)*var(OJ2[, 1]))/(nrow(OJ1)+nrow(OJ2)-2)
t <- (mean(OJ1[, 1]) - mean(OJ2[, 1])) / (sqrt(var)*(1/10+1/10)^0.5)
t
ci <- (mean(OJ1[, 1]) - mean(OJ2[, 1])) + 1 * qt(0.95, 18) * (sqrt(var)*(1/10+1/10)^0.5)
ci
vOJ1 <- var(OJ1[, 1])
vOJ2 <- var(OJ2[, 1])
nOJ1 <- nrow(OJ1)
nOJ2 <- nrow(OJ2)
df <- ((vOJ1/nOJ1 + vOJ2/nOJ2)^2)/((vOJ1/nOJ1)^2/(nOJ1-1) + (vOJ2/nOJ2)^2/(nOJ2-1))
df
p <- pt(t, df = df)
p
```

The manual checks agree with t.test. Again the difference is significant at the 5% level.

### VC
#### *Is the additional length seen at dosage 1 significantly higher than at dosage 0.5?*

**Null hypothesis:** The mean of VC's dosage 1 is the same as the mean of VC's dosage 0.5.  
**Alternative hypothesis:** The mean of VC's dosage 1 is greater than the mean of VC's dosage 0.5.

```{r VC 0.5 and 1}
VC0 <- filter(ToothGrowth, supp == "VC", dose == 0.5)
VC1 <- filter(ToothGrowth, supp == "VC", dose == 1)
vVC0 <- var(VC0[, 1])
vVC1 <- var(VC1[, 1])
nVC0 <- nrow(VC0)
nVC1 <- nrow(VC1)
vVC01 <- ((nVC0-1)*vVC0 + (nVC1-1)*vVC1)/(nVC0+nVC1-2)
t.test(VC0[, 1], VC1[, 1], "less", paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

Manual check:

```{r VC 0.5 and 1 checks}
tVC01 <- (mean(VC0[, 1]) - mean(VC1[, 1]))/(sqrt(vVC01)*(1/nVC0 + 1/nVC1)^0.5)
tVC01
dfVC01 <- (vVC0/nVC0 + vVC1/nVC1)^2/((vVC0/nVC0)^2/(nVC0-1) + (vVC1/nVC1)^2/(nVC1 - 1))
ciVC01 <- mean(VC0[, 1]) - mean(VC1[, 1]) + 1 * qt(0.95, dfVC01) * sqrt(vVC01) * (1/nVC0 + 1/nVC1)^0.5
ciVC01
pVC01 <- pt(tVC01, dfVC01)
pVC01

```

#### *Is the additional length seen at dosage 2 significantly higher than at dosage 1?*

**Null hypothesis:** The mean of VC's dosage 2 is the same as the mean of VC's dosage 1.  
**Alternative hypothesis:** The mean of VC's dosage 2 is greater than the mean of VC's dosage 1.

```{r VC 1 and 2}
VC2 <- filter(ToothGrowth, supp == "VC", dose == 2)
nVC2 <- nrow(VC2)
vVC2 <- var(VC2[, 1])
vVC12 <- ((nVC1-1)* vVC1 + (nVC2-1)*vVC2)/(nVC1+nVC2-2)
t.test(VC1[, 1], VC2[, 1], alt="less", paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

Manual checks:

```{r VC 1 and 2 checks}
tVC12 <- (mean(VC1[, 1]) - mean(VC2[, 1])) / (sqrt(vVC12) * sqrt(1/nVC1 + 1/nVC2))
tVC12
dfVC12 <- (vVC1/nVC1 + vVC2/nVC2)^2/((vVC1/nVC1)^2/(nVC1-1) + (vVC2/nVC2)^2/(nVC2-1))
dfVC12
ciVC12 <- mean(VC1[, 1]) - mean(VC2[, 1]) + 1 * qt(0.95, dfVC12) * sqrt(vVC12* (1/nVC1 + 1/nVC2))
ciVC12
pVC12 <- pt(tVC12, dfVC12)
pVC12
```